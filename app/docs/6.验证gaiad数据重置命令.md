# 验证 gaiad 数据重置命令

本文档提供了验证 gaiad 数据是否已经成功重置的各种命令和方法。在运行 `restart-gaia.sh` 脚本或执行数据重置操作后，可以使用这些命令来确认重置是否成功。

## 1. 检查节点状态和区块高度

### 查看节点状态
```bash
# 查看节点状态（如果节点正在运行）
gaiad status
```

### 查看最新区块信息
```bash
# 查看最新区块信息
gaiad query block
```

**验证标准**: 如果数据重置成功，区块高度应该从 0 或 1 开始。

## 2. 检查数据目录

### 查看数据目录内容
```bash
# 查看默认数据目录的内容
ls -la ~/.gaia/data/

# 检查区块存储目录
ls -la ~/.gaia/data/blockstore.db/

# 检查状态数据库
ls -la ~/.gaia/data/state.db/
```

**验证标准**: 重置后，这些目录应该是空的或者只包含初始文件。

## 3. 检查 CometBFT 状态

### 查看节点 ID 和验证人信息
```bash
# 查看 CometBFT 状态
gaiad comet show-node-id

# 查看验证人信息
gaiad comet show-validator
```

## 4. 查看创世文件状态

### 检查创世文件配置
```bash
# 检查创世文件是否存在并查看初始高度
cat ~/.gaia/config/genesis.json | jq '.initial_height'

# 查看链 ID
gaiad config chain-id
```

## 5. 最直接的验证方法 - 查看启动日志

### 启动节点并观察日志
```bash
# 启动节点并查看日志
gaiad start --log_level info
```

### 后台启动并查看日志文件
```bash
# 在后台启动并查看日志文件
gaiad start > gaia.log 2>&1 &
tail -f gaia.log
```

**重置成功的标志包括**:
- 日志显示从区块高度 0 或 1 开始
- 没有关于恢复旧状态的消息
- 节点正常启动并开始产生新区块

## 6. 检查特定的重置命令结果

### 重新执行重置命令
```bash
# 重新执行重置命令查看输出
gaiad comet unsafe-reset-all

# 查看命令执行结果
echo $?  # 返回 0 表示成功
```

## 验证流程建议

建议按以下顺序执行验证：

1. **首先检查数据目录** - 确认数据文件已被清除
2. **启动节点** - 使用 `gaiad start` 启动节点
3. **查看启动日志** - 观察节点是否从区块高度 0/1 开始
4. **检查节点状态** - 使用 `gaiad status` 确认当前状态
5. **验证区块高度** - 确认区块高度重新开始计数

## 常见问题排查

### 如果重置失败
- 确保节点已完全停止再执行重置命令
- 检查是否有权限问题阻止删除数据文件
- 确认使用了正确的数据目录路径

### 如果节点无法启动
- 检查创世文件是否正确配置
- 确认配置文件没有损坏
- 查看详细的错误日志信息

## 相关文件和脚本

- `runDoc/restart-gaia.sh` - 重启 gaia 节点的脚本
- `runDoc/start-gaia.sh` - 启动 gaia 节点的脚本
- `~/.gaia/config/genesis.json` - 创世文件
- `~/.gaia/data/` - 节点数据目录

## 注意事项

⚠️ **警告**: 数据重置操作会永久删除所有区块链数据，请确保在测试环境中操作，或者已经备份了重要数据。

💡 **提示**: 在生产环境中，建议使用快照恢复而不是完全重置来恢复节点状态。