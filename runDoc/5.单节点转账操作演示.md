# 单节点转账操作演示

本文档演示如何在 Gaia 单节点环境中进行转账操作。单节点虽然只有一个验证者，但完全可以处理和确认交易。

## 🏗️ 单节点环境说明

### 初始账户设置

根据 `contrib/single-node.sh` 脚本，单节点初始化时会创建两个账户：

1. **validator** - 验证者账户，初始余额：100000000000stake
2. **user** - 普通用户账户，初始余额：100000000000stake

### 为什么单节点可以进行转账？

- **自我验证**：单节点既是验证者又是网络的唯一节点
- **即时确认**：交易提交后立即被验证和确认
- **完整功能**：具备完整的区块链功能，包括交易处理、状态更新等

## 🚀 转账操作步骤

### 1. 启动单节点

```bash
# 方法一：使用我们的启动脚本
./runDoc/start-gaia.sh

# 方法二：使用 JavaScript 版本
node ./runDoc/start-gaia.js

# 方法三：直接使用官方脚本
./contrib/single-node.sh
```

### 2. 查看现有账户

```bash
# 查看所有账户
gaiad keys list --keyring-backend=test

# 查看 validator 账户地址
gaiad keys show validator -a --keyring-backend=test

# 查看 user 账户地址
gaiad keys show user -a --keyring-backend=test
```

### 3. 查看账户余额

```bash
# 查看 validator 账户余额
gaiad query bank balances $(gaiad keys show validator -a --keyring-backend=test)

# 查看 user 账户余额
gaiad query bank balances $(gaiad keys show user -a --keyring-backend=test)
```

### 4. 创建新账户（可选）

```bash
# 创建新的接收账户
gaiad keys add recipient --keyring-backend=test

# 查看新账户地址
gaiad keys show recipient -a --keyring-backend=test
```

### 5. 执行转账操作

#### 从 validator 向 user 转账

```bash
# 转账 1000stake 从 validator 到 user
gaiad tx bank send \
  $(gaiad keys show validator -a --keyring-backend=test) \
  $(gaiad keys show user -a --keyring-backend=test) \
  1000stake \
  --keyring-backend=test \
  --chain-id=test-gaia \
  --gas=auto \
  --gas-adjustment=1.5 \
  --fees=100stake \
  --yes
```

#### 从 user 向新账户转账

```bash
# 转账 500stake 从 user 到 recipient
gaiad tx bank send \
  $(gaiad keys show user -a --keyring-backend=test) \
  $(gaiad keys show recipient -a --keyring-backend=test) \
  500stake \
  --keyring-backend=test \
  --chain-id=test-gaia \
  --gas=auto \
  --gas-adjustment=1.5 \
  --fees=100stake \
  --yes
```

### 6. 验证转账结果

```bash
# 查看交易哈希（从上一步的输出中获取）
gaiad query tx <TRANSACTION_HASH>

# 再次查看所有账户余额
gaiad query bank balances $(gaiad keys show validator -a --keyring-backend=test)
gaiad query bank balances $(gaiad keys show user -a --keyring-backend=test)
gaiad query bank balances $(gaiad keys show recipient -a --keyring-backend=test)
```

## 📋 完整演示脚本

### 自动化转账演示脚本

```bash
#!/bin/bash

echo "=== Gaia 单节点转账演示 ==="

# 设置变量
KEYRING="--keyring-backend=test"
CHAIN_ID="--chain-id=test-gaia"
GAS="--gas=auto --gas-adjustment=1.5"
FEES="--fees=100stake"

echo "1. 查看现有账户..."
gaiad keys list $KEYRING

echo -e "\n2. 查看初始余额..."
VALIDATOR_ADDR=$(gaiad keys show validator -a $KEYRING)
USER_ADDR=$(gaiad keys show user -a $KEYRING)

echo "Validator 地址: $VALIDATOR_ADDR"
echo "User 地址: $USER_ADDR"

echo "Validator 余额:"
gaiad query bank balances $VALIDATOR_ADDR

echo "User 余额:"
gaiad query bank balances $USER_ADDR

echo -e "\n3. 创建新的接收账户..."
gaiad keys add recipient $KEYRING --output json

RECIPIENT_ADDR=$(gaiad keys show recipient -a $KEYRING)
echo "Recipient 地址: $RECIPIENT_ADDR"

echo -e "\n4. 执行转账：validator -> user (1000stake)..."
TX1=$(gaiad tx bank send $VALIDATOR_ADDR $USER_ADDR 1000stake $KEYRING $CHAIN_ID $GAS $FEES --yes --output json | jq -r '.txhash')
echo "交易哈希: $TX1"

echo -e "\n5. 等待交易确认..."
sleep 3

echo -e "\n6. 执行转账：user -> recipient (500stake)..."
TX2=$(gaiad tx bank send $USER_ADDR $RECIPIENT_ADDR 500stake $KEYRING $CHAIN_ID $GAS $FEES --yes --output json | jq -r '.txhash')
echo "交易哈希: $TX2"

echo -e "\n7. 等待交易确认..."
sleep 3

echo -e "\n8. 查看最终余额..."
echo "Validator 最终余额:"
gaiad query bank balances $VALIDATOR_ADDR

echo "User 最终余额:"
gaiad query bank balances $USER_ADDR

echo "Recipient 最终余额:"
gaiad query bank balances $RECIPIENT_ADDR

echo -e "\n9. 查看交易详情..."
echo "交易 1 详情:"
gaiad query tx $TX1

echo "交易 2 详情:"
gaiad query tx $TX2

echo -e "\n=== 转账演示完成 ==="
```

## 🔍 命令参数说明

### 转账命令参数详解

- `--keyring-backend=test` - 使用测试密钥环（不需要密码）
- `--chain-id=test-gaia` - 指定链 ID
- `--gas=auto` - 自动计算 gas
- `--gas-adjustment=1.5` - gas 调整系数
- `--fees=100stake` - 交易手续费
- `--yes` - 自动确认交易

### 查询命令

- `gaiad keys list` - 列出所有账户
- `gaiad keys show <name> -a` - 显示账户地址
- `gaiad query bank balances <address>` - 查询余额
- `gaiad query tx <hash>` - 查询交易详情

## 💡 实用技巧

### 1. 使用别名简化命令

```bash
# 在 ~/.bashrc 或 ~/.zshrc 中添加
alias gaia-send="gaiad tx bank send --keyring-backend=test --chain-id=test-gaia --gas=auto --gas-adjustment=1.5 --fees=100stake --yes"
alias gaia-balance="gaiad query bank balances"
alias gaia-keys="gaiad keys list --keyring-backend=test"

# 使用别名
gaia-send $VALIDATOR_ADDR $USER_ADDR 1000stake
```

### 2. 批量转账脚本

```bash
#!/bin/bash
# 批量转账到多个地址

SENDER=$(gaiad keys show validator -a --keyring-backend=test)
RECIPIENTS=("addr1" "addr2" "addr3")
AMOUNT="100stake"

for recipient in "${RECIPIENTS[@]}"; do
    echo "转账 $AMOUNT 到 $recipient"
    gaiad tx bank send $SENDER $recipient $AMOUNT \
        --keyring-backend=test \
        --chain-id=test-gaia \
        --gas=auto \
        --gas-adjustment=1.5 \
        --fees=100stake \
        --yes
    sleep 2
done
```

### 3. 监控余额变化

```bash
#!/bin/bash
# 实时监控账户余额

ADDR=$(gaiad keys show validator -a --keyring-backend=test)

while true; do
    clear
    echo "=== 账户余额监控 ==="
    echo "地址: $ADDR"
    echo "时间: $(date)"
    gaiad query bank balances $ADDR
    sleep 5
done
```

## ⚠️ 注意事项

1. **测试环境**：这是测试环境，使用的是测试代币 `stake`
2. **密钥安全**：使用 `--keyring-backend=test` 仅适用于测试
3. **手续费**：每笔交易都需要支付手续费
4. **确认时间**：单节点确认很快，通常 1-2 秒
5. **余额检查**：转账前确保有足够余额支付金额和手续费

## 🎯 常见问题

### Q: 为什么转账失败？
A: 检查以下几点：
- 余额是否足够（包括手续费）
- 地址是否正确
- 节点是否正在运行
- 链 ID 是否匹配

### Q: 如何查看交易状态？
A: 使用交易哈希查询：
```bash
gaiad query tx <TRANSACTION_HASH>
```

### Q: 如何加速交易确认？
A: 单节点环境下交易确认已经很快，如需更快可以：
- 增加 gas 费用
- 调整节点配置中的 `timeout_commit`

这样你就可以在单节点环境中完整地演示转账操作了！