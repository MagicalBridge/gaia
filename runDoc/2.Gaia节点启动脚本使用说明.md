# Gaia 节点操作指南

本文档详细介绍了 Gaia 节点启动后可以执行的各种操作。

## 前提条件

确保节点已经启动并正在运行：
```bash
# 启动节点
./start-gaia.sh

# 或者重启节点
./restart-gaia.sh
```

## 1. 基本节点状态查询

### 1.1 查询节点状态
```bash
gaiad status
```
返回节点信息、同步状态、验证者信息等。

### 1.2 查询节点信息
```bash
# 查询节点 ID
gaiad tendermint show-node-id

# 查询验证者地址
gaiad tendermint show-validator

# 查询验证者公钥
gaiad tendermint show-address
```

### 1.3 查询区块信息
```bash
# 查询最新区块
gaiad query block

# 查询指定高度的区块
gaiad query block 100

# 查询区块结果
gaiad query block-results 100
```

## 2. 账户和钱包管理

### 2.1 密钥管理
```bash
# 创建新账户
gaiad keys add <account_name> --keyring-backend test

# 列出所有账户
gaiad keys list --keyring-backend test

# 显示账户地址
gaiad keys show <account_name> --keyring-backend test

# 删除账户
gaiad keys delete <account_name> --keyring-backend test

# 从助记词恢复账户
gaiad keys add <account_name> --recover --keyring-backend test
```

### 2.2 账户余额查询
```bash
# 查询账户余额
gaiad query bank balances <address>

# 查询特定代币余额
gaiad query bank balance <address> <denom>

# 查询总供应量
gaiad query bank total

# 查询特定代币供应量
gaiad query bank supply <denom>
```

## 3. 交易操作

### 3.1 转账交易
```bash
# 基本转账
gaiad tx bank send <from_key_or_address> <to_address> <amount> \
  --keyring-backend test \
  --chain-id test-gaia \
  --fees 200000stake \
  --yes

# 示例
gaiad tx bank send validator cosmos1tlnjtnqj9wt74f9krrr7ku7u2d8qs0nnw4l50z 1000000stake \
  --keyring-backend test \
  --chain-id test-gaia \
  --fees 200000stake \
  --yes
```

### 3.2 多重发送
```bash
gaiad tx bank multi-send <from_key_or_address> <to_address1> <amount1> <to_address2> <amount2> \
  --keyring-backend test \
  --chain-id test-gaia \
  --fees 200000stake \
  --yes
```

### 3.3 查询交易
```bash
# 通过交易哈希查询
gaiad query tx <txhash>

# 查询账户交易历史
gaiad query txs --events 'message.sender=<address>'
```

## 4. 质押操作

### 4.1 验证者查询
```bash
# 查询所有验证者
gaiad query staking validators

# 查询特定验证者
gaiad query staking validator <validator_address>

# 查询验证者集合
gaiad query staking validators-set
```

### 4.2 委托操作
```bash
# 委托质押
gaiad tx staking delegate <validator_address> <amount> \
  --from <key_name> \
  --keyring-backend test \
  --chain-id test-gaia \
  --fees 200000stake \
  --yes

# 示例
gaiad tx staking delegate cosmosvaloper1nms8q6fsz06xa5ywpc3gcyuwptwatdj8zrhr0m 500000stake \
  --from alice \
  --keyring-backend test \
  --chain-id test-gaia \
  --fees 200000stake \
  --yes
```

### 4.3 重新委托
```bash
gaiad tx staking redelegate <src_validator_address> <dst_validator_address> <amount> \
  --from <key_name> \
  --keyring-backend test \
  --chain-id test-gaia \
  --fees 200000stake \
  --yes
```

### 4.4 解除委托
```bash
gaiad tx staking unbond <validator_address> <amount> \
  --from <key_name> \
  --keyring-backend test \
  --chain-id test-gaia \
  --fees 200000stake \
  --yes
```

### 4.5 查询委托信息
```bash
# 查询账户的所有委托
gaiad query staking delegations <delegator_address>

# 查询特定验证者的委托
gaiad query staking delegation <delegator_address> <validator_address>

# 查询解除委托
gaiad query staking unbonding-delegations <delegator_address>

# 查询重新委托
gaiad query staking redelegations <delegator_address>
```

## 5. 奖励和分配

### 5.1 查询奖励
```bash
# 查询委托奖励
gaiad query distribution rewards <delegator_address>

# 查询特定验证者的奖励
gaiad query distribution rewards <delegator_address> <validator_address>

# 查询佣金
gaiad query distribution commission <validator_address>
```

### 5.2 提取奖励
```bash
# 提取所有奖励
gaiad tx distribution withdraw-all-rewards \
  --from <key_name> \
  --keyring-backend test \
  --chain-id test-gaia \
  --fees 200000stake \
  --yes

# 提取特定验证者的奖励
gaiad tx distribution withdraw-rewards <validator_address> \
  --from <key_name> \
  --keyring-backend test \
  --chain-id test-gaia \
  --fees 200000stake \
  --yes
```

## 6. 治理操作

### 6.1 查询治理信息
```bash
# 查询所有提案
gaiad query gov proposals

# 查询特定提案
gaiad query gov proposal <proposal_id>

# 查询治理参数
gaiad query gov params

# 查询提案的投票
gaiad query gov votes <proposal_id>

# 查询特定账户的投票
gaiad query gov vote <proposal_id> <voter_address>
```

### 6.2 提交提案
```bash
# 文本提案
gaiad tx gov submit-proposal \
  --title="Test Proposal" \
  --description="This is a test proposal" \
  --type="Text" \
  --deposit="10000000stake" \
  --from <key_name> \
  --keyring-backend test \
  --chain-id test-gaia \
  --fees 200000stake \
  --yes
```

### 6.3 投票
```bash
# 对提案投票 (yes/no/abstain/no_with_veto)
gaiad tx gov vote <proposal_id> yes \
  --from <key_name> \
  --keyring-backend test \
  --chain-id test-gaia \
  --fees 200000stake \
  --yes
```

### 6.4 存款
```bash
# 为提案存款
gaiad tx gov deposit <proposal_id> <amount> \
  --from <key_name> \
  --keyring-backend test \
  --chain-id test-gaia \
  --fees 200000stake \
  --yes
```

## 7. IBC 操作 (跨链)

### 7.1 查询 IBC 信息
```bash
# 查询 IBC 客户端
gaiad query ibc client states

# 查询 IBC 连接
gaiad query ibc connection connections

# 查询 IBC 通道
gaiad query ibc channel channels
```

### 7.2 IBC 转账
```bash
gaiad tx ibc-transfer transfer <src_port> <src_channel> <receiver> <amount> \
  --from <key_name> \
  --keyring-backend test \
  --chain-id test-gaia \
  --fees 200000stake \
  --yes
```

## 8. 高级查询

### 8.1 模块参数查询
```bash
# 查询银行模块参数
gaiad query bank params

# 查询质押模块参数
gaiad query staking params

# 查询分配模块参数
gaiad query distribution params

# 查询治理模块参数
gaiad query gov params

# 查询薄荷模块参数
gaiad query mint params
```

### 8.2 状态查询
```bash
# 查询应用状态
gaiad query app-state

# 查询模块账户
gaiad query auth module-accounts

# 查询账户信息
gaiad query auth account <address>
```

## 9. 实用工具

### 9.1 地址转换
```bash
# 验证地址格式
gaiad debug addr <address>

# 公钥转地址
gaiad debug pubkey <pubkey>
```

### 9.2 交易构建和签名
```bash
# 生成未签名交易
gaiad tx bank send <from> <to> <amount> \
  --generate-only \
  --keyring-backend test \
  --chain-id test-gaia > unsigned_tx.json

# 签名交易
gaiad tx sign unsigned_tx.json \
  --from <key_name> \
  --keyring-backend test \
  --chain-id test-gaia > signed_tx.json

# 广播交易
gaiad tx broadcast signed_tx.json
```

## 10. 常用参数说明

- `--keyring-backend test`: 使用测试密钥环（开发环境）
- `--chain-id test-gaia`: 指定链 ID
- `--fees 200000stake`: 指定交易手续费
- `--gas auto`: 自动估算 gas
- `--gas-adjustment 1.5`: gas 调整系数
- `--yes`: 跳过交易确认
- `--dry-run`: 模拟执行，不实际发送交易
- `--generate-only`: 只生成交易，不签名和广播

## 11. 故障排除

### 11.1 常见错误
- `connection refused`: 节点未启动
- `insufficient fee`: 手续费不足
- `account sequence mismatch`: 账户序列号不匹配
- `insufficient funds`: 余额不足

### 11.2 解决方案
```bash
# 重置账户序列号
gaiad query auth account <address>

# 检查节点状态
gaiad status

# 重启节点
./restart-gaia.sh
```

## 12. 安全注意事项

1. **生产环境**: 使用 `--keyring-backend os` 或 `--keyring-backend file`
2. **助记词**: 安全保存助记词，不要泄露
3. **私钥**: 不要在命令行中直接使用私钥
4. **网络**: 确保 RPC 端点的安全性
5. **权限**: 合理设置文件和目录权限

---

更多详细信息请参考 [Cosmos SDK 官方文档](https://docs.cosmos.network/) 和 [Gaia 文档](https://hub.cosmos.network/)。